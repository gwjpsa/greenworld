# -*- coding: utf-8 -*-
"""
Created on Thu Dec  7 12:42:58 2023

@author: joaos
"""

import requests

values = '''{
  "user_login": {
    "email": "joao.sa@greenworld.pt",
    "password": "GMkHuQ"
  }
}'''

headers = {
   'X-User-Api-Token': '68nGDYSZyAP58K2LWDHQ',
  'Content-Type': 'application/json'
}

response = requests.post('https://operations.cropwise.com/api/v3/sign_in', data=values, headers=headers)

print(response.status_code)
print(response.headers)
print(response.json())

#%%
import requests
import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
import psycopg2

headers = {
   'X-User-Api-Token': '68nGDYSZyAP58K2LWDHQ',
  'Content-Type': 'application/json'
}

fields_id_cropio = [
    '4064-12',
    '4065-13',
    '4066-21',
    '4067-22',
    '4068-23',
    '4069-24',
    '4070-25',
    '4071-655',
    '4072-32',
    '4073-33',
    '4074-34',
    '4075-35',
    '4076-71',
    '4077-72',
    '4078-73',
    '4079-74',
    '4080-75',
    '4081-76',
    '4082-77',
    '4083-82',
    '4084-83',
    '4085-113',
    '4086-114',
    '4087-122',
    '4088-123',
    '4089-126',
    '4090-137',
    '4091-138',
    '4092-146',
    '4093-158',
    '4094-159',
    '4095-160',
    '4096-161',
    '4097-193',
    '4098-208',
    '4099-209',
    '4100-212',
    '4101-213',
    '4102-214',
    '4103-227',
    '4104-229',
    '4105-233',
    '4106-234',
    '4107-235',
    '4108-236',
    '4109-237',
    '4110-272',
    '4111-273',
    '4112-274',
    '4113-275',
    '4114-276',
    '4115-277',
    '4116-278',
    '4117-279',
    '4118-280',
    '4119-281',
    '4120-282',
    '4121-285',
    '4122-306',
    '4123-362',
    '4124-378',
    '4125-383',
    '4126-384',
    '4127-390',
    '4128-391',
    '4129-406',
    '4130-469',
    '4131-493',
    '4132-503',
    '4133-506',
    '4134-507',
    '4135-525',
    '4136-526',
    '4137-560',
    '4138-565',
    '4139-573',
    '4140-575',
    '4141-577',
    '4142-607',
    '4143-608',
    '4144-4',
    '4145-653',
    '4146-654',
    '4147-656',
    '4148-657',
    '4149-658',
    '4150-659',
    '4151-660',
    '4152-1',
    '4153-2',
    '4154-3',
    '4155-8',
    '4156-9',
    '4157-11',
    '4158-15',
    '4159-16',
    '4160-17',
    '4161-18',
    '4162-19',
    '4163-20',
    '4164-26',
    '4165-27',
    '4166-28',
    '4167-29',
    '4168-31',
    '4169-30',
    '4170-38',
    '4171-39',
    '4172-40',
    '4173-41',
    '4174-42',
    '4175-43',
    '4176-44',
    '4177-45',
    '4178-48',
    '4179-49',
    '4180-50',
    '4181-51',
    '4182-52',
    '4183-53',
    '4184-54',
    '4185-56',
    '4186-57',
    '4187-58',
    '4188-59',
    '4189-60',
    '4190-61',
    '4191-90',
    '4192-55',
    '4193-62',
    '4194-63',
    '4195-64',
    '4196-65',
    '4197-66',
    '4198-67',
    '4199-68',
    '4200-69',
    '4201-70',
    '4202-79',
    '4203-80',
    '4204-81',
    '4205-84',
    '4206-85',
    '4207-86',
    '4208-87',
    '4209-88',
    '4210-91',
    '4211-92',
    '4212-93',
    '4213-94',
    '4214-95',
    '4215-96',
    '4216-100',
    '4217-102',
    '4218-103',
    '4219-105',
    '4220-106',
    '4221-107',
    '4222-108',
    '4223-109',
    '4224-110',
    '4225-111',
    '4226-112',
    '4227-115',
    '4228-116',
    '4229-117',
    '4230-118',
    '4231-119',
    '4232-120',
    '4233-121',
    '4234-124',
    '4235-125',
    '4236-127',
    '4237-128',
    '4238-129',
    '4239-130',
    '4240-131',
    '4241-132',
    '4242-133',
    '4243-134',
    '4244-135',
    '4245-136',
    '4246-139',
    '4247-140',
    '4248-141',
    '4249-142',
    '4250-143',
    '4251-144',
    '4252-145',
    '4253-147',
    '4254-148',
    '4255-150',
    '4256-151',
    '4257-152',
    '4258-153',
    '4259-154',
    '4260-155',
    '4261-156',
    '4262-157',
    '4263-163',
    '4264-164',
    '4265-165',
    '4266-166',
    '4267-167',
    '4268-168',
    '4269-169',
    '4270-170',
    '4271-171',
    '4272-172',
    '4273-173',
    '4274-174',
    '4275-175',
    '4276-177',
    '4277-178',
    '4278-179',
    '4279-180',
    '4280-181',
    '4281-182',
    '4282-183',
    '4283-184',
    '4284-185',
    '4285-186',
    '4286-187',
    '4287-188',
    '4288-189',
    '4289-190',
    '4290-191',
    '4291-194',
    '4292-195',
    '4293-196',
    '4294-198',
    '4295-199',
    '4296-200',
    '4297-201',
    '4298-202',
    '4299-203',
    '4300-204',
    '4301-210',
    '4302-211',
    '4303-215',
    '4304-216',
    '4305-217',
    '4306-218',
    '4307-219',
    '4308-220',
    '4309-221',
    '4310-222',
    '4311-223',
    '4312-224',
    '4313-225',
    '4314-226',
    '4315-230',
    '4316-231',
    '4317-232',
    '4318-238',
    '4319-239',
    '4320-240',
    '4321-241',
    '4322-242',
    '4323-243',
    '4324-244',
    '4325-245',
    '4326-246',
    '4327-247',
    '4328-248',
    '4329-252',
    '4330-253',
    '4331-254',
    '4332-255',
    '4333-256',
    '4334-257',
    '4335-259',
    '4336-266',
    '4337-267',
    '4338-268',
    '4339-269',
    '4340-270',
    '4341-271',
    '4342-283',
    '4343-286',
    '4344-287',
    '4345-288',
    '4346-289',
    '4347-290',
    '4348-291',
    '4349-292',
    '4350-293',
    '4351-294',
    '4352-295',
    '4353-296',
    '4354-297',
    '4355-298',
    '4356-299',
    '4357-300',
    '4358-301',
    '4359-302',
    '4360-303',
    '4361-304',
    '4362-305',
    '4363-307',
    '4364-308',
    '4365-309',
    '4366-310',
    '4367-311',
    '4368-312',
    '4369-313',
    '4370-314',
    '4371-317',
    '4372-321',
    '4373-324',
    '4374-325',
    '4375-326',
    '4376-327',
    '4377-328',
    '4378-329',
    '4379-330',
    '4380-334',
    '4381-335',
    '4382-336',
    '4383-337',
    '4384-338',
    '4385-339',
    '4386-340',
    '4387-341',
    '4388-342',
    '4389-343',
    '4390-344',
    '4391-345',
    '4392-346',
    '4393-347',
    '4394-348',
    '4395-350',
    '4396-351',
    '4397-353',
    '4398-354',
    '4399-355',
    '4400-356',
    '4401-358',
    '4402-359',
    '4403-360',
    '4404-361',
    '4405-363',
    '4406-364',
    '4407-365',
    '4408-366',
    '4409-367',
    '4410-368',
    '4411-369',
    '4412-370',
    '4413-371',
    '4414-372',
    '4415-373',
    '4416-374',
    '4417-375',
    '4418-376',
    '4419-377',
    '4420-379',
    '4421-380',
    '4422-388',
    '4423-389',
    '4424-392',
    '4425-393',
    '4426-395',
    '4427-396',
    '4428-397',
    '4429-398',
    '4430-399',
    '4431-400',
    '4432-401',
    '4433-402',
    '4434-403',
    '4435-404',
    '4436-405',
    '4437-407',
    '4438-408',
    '4439-409',
    '4440-410',
    '4441-411',
    '4442-412',
    '4443-413',
    '4444-414',
    '4445-415',
    '4446-416',
    '4447-417',
    '4448-419',
    '4449-420',
    '4450-422',
    '4451-423',
    '4452-425',
    '4453-426',
    '4454-427',
    '4455-428',
    '4456-429',
    '4457-430',
    '4458-431',
    '4459-432',
    '4460-434',
    '4461-435',
    '4462-436',
    '4463-437',
    '4464-438',
    '4465-439',
    '4466-440',
    '4467-443',
    '4468-444',
    '4469-445',
    '4470-446',
    '4471-449',
    '4472-450',
    '4473-451',
    '4474-452',
    '4475-455',
    '4476-456',
    '4477-459',
    '4478-463',
    '4479-464',
    '4480-465',
    '4481-466',
    '4482-467',
    '4483-468',
    '4484-470',
    '4485-471',
    '4486-472',
    '4487-473',
    '4488-474',
    '4489-475',
    '4490-476',
    '4491-477',
    '4492-478',
    '4493-479',
    '4494-480',
    '4495-481',
    '4496-482',
    '4497-483',
    '4498-484',
    '4499-485',
    '4500-486',
    '4501-487',
    '4502-488',
    '4503-489',
    '4504-490',
    '4505-491',
    '4506-494',
    '4507-495',
    '4508-496',
    '4509-497',
    '4510-498',
    '4511-500',
    '4512-501',
    '4513-502',
    '4514-504',
    '4515-505',
    '4516-509',
    '4517-511',
    '4518-512',
    '4519-513',
    '4520-514',
    '4521-515',
    '4522-516',
    '4523-517',
    '4524-518',
    '4525-519',
    '4526-520',
    '4527-521',
    '4528-522',
    '4529-523',
    '4530-524',
    '4531-550',
    '4532-527',
    '4533-530',
    '4534-531',
    '4535-532',
    '4536-533',
    '4537-536',
    '4538-537',
    '4539-538',
    '4540-539',
    '4541-540',
    '4542-541',
    '4543-542',
    '4544-543',
    '4545-544',
    '4546-545',
    '4547-546',
    '4548-547',
    '4549-548',
    '4550-549',
    '4551-551',
    '4552-552',
    '4553-553',
    '4554-554',
    '4555-555',
    '4556-556',
    '4557-557',
    '4558-561',
    '4559-562',
    '4560-567',
    '4561-571',
    '4562-572',
    '4563-574',
    '4564-579',
    '4565-580',
    '4566-581',
    '4567-582',
    '4568-583',
    '4569-584',
    '4570-585',
    '4571-586',
    '4572-587',
    '4573-588',
    '4574-589',
    '4575-590',
    '4576-591',
    '4577-592',
    '4578-593',
    '4579-594',
    '4580-596',
    '4581-597',
    '4582-598',
    '4583-599',
    '4584-600',
    '4585-601',
    '4586-602',
    '4587-603',
    '4588-604',
    '4589-605',
    '4590-609',
    '4591-610',
    '4592-611',
    '4593-614',
    '4594-620',
    '4595-621',
    '4596-622',
    '4597-623',
    '4598-624',
    '4599-625',
    '4600-612',
    '4601-618',
    '4602-626',
    '4603-629',
    '4604-632',
    '4605-633',
    '4606-634',
    '4607-635',
    '4608-636',
    '4609-637',
    '4610-638',
    '4611-639',
    '4612-640',
    '4613-641',
    '4614-642',
    '4615-643',
    '4616-5',
    '4617-6',
    '4618-7',
    '4619-644',
    '4620-645',
    '4621-646',
    '4622-647',
    '4623-648',
    '4624-649',
    '4625-650',
    '4626-263',
    '4627-576',
    '4628-559'
]

id_cropio_agriculturefields = {
    '4':'639',
    '567':'179',
    '263':'528',
    '576':'569',
    '567':'577',
    '283':'869',
    '35':'492',
    '34':'493',
    '33':'494',
    '39':'4',
    '38':'491',
    '41':'490',
    '43':'486',
    '44':'485',
    '42':'487',
    '45':'484',
    '50':'513',
    '48':'515',
    '49':'514',
    '51':'7',
    '56':'12',
    '57':'13',
    '58':'14',
    '55':'501',
    '54':'509',
    '53':'510',
    '52':'511',
    '60':'504',
    '59':'505',
    '61':'15',
    '62':'500',
    '64':'530',
    '63':'531',
    '66':'527',
    '65':'529',
    '67':'454',
    '70':'524',
    '69':'525',
    '68':'526',
    '76':'517',
    '75':'518',
    '77':'519',
    '74':'520',
    '73':'521',
    '72':'522',
    '71':'523',
    '79':'692',
    '80':'516',
    '81':'292',
    '83':'290',
    '82':'291',
    '84':'289',
    '86':'287',
    '85':'288',
    '88':'285',
    '87':'286',
    '90':'502',
    '95':'282',
    '94':'283',
    '91':'284',
    '93':'711',
    '92':'712',
    '96':'281',
    '596':'196',
    '103':'23',
    '105':'25',
    '102':'279',
    '100':'280',
    '106':'308',
    '107':'307',
    '108':'305',
    '109':'303',
    '111':'302',
    '110':'304',
    '112':'301',
    '113':'300',
    '114':'299',
    '119':'294',
    '118':'295',
    '117':'296',
    '116':'297',
    '115':'298',
    '120':'293',
    '121':'324',
    '123':'322',
    '122':'323',
    '124':'27',
    '125':'28',
    '126':'318',
    '328':'88',
    '127':'319',
    '128':'317',
    '130':'315',
    '129':'316',
    '132':'313',
    '131':'314',
    '133':'312',
    '135':'309',
    '134':'311',
    '136':'31',
    '138':'338',
    '137':'339',
    '139':'337',
    '141':'336',
    '140':'497',
    '143':'334',
    '142':'335',
    '629':'623',
    '626':'624',
    '146':'331',
    '147':'34',
    '148':'35',
    '152':'325',
    '151':'326',
    '157':'352',
    '156':'353',
    '155':'354',
    '154':'355',
    '153':'356',
    '150':'328',
    '158':'351',
    '160':'349',
    '159':'350',
    '161':'348',
    '163':'347',
    '144':'32',
    '145':'33',
    '164':'37',
    '165':'38',
    '166':'39',
    '168':'343',
    '167':'344',
    '169':'40',
    '170':'41',
    '171':'42',
    '172':'371',
    '173':'44',
    '174':'369',
    '175':'45',
    '178':'366',
    '177':'367',
    '180':'364',
    '179':'365',
    '181':'363',
    '201':'377',
    '182':'362',
    '183':'359',
    '184':'358',
    '185':'357',
    '186':'388',
    '191':'383',
    '190':'384',
    '189':'385',
    '188':'386',
    '187':'387',
    '193':'382',
    '195':'380',
    '194':'381',
    '196':'761',
    '198':'760',
    '200':'378',
    '199':'379',
    '202':'376',
    '346':'249',
    '204':'374',
    '203':'375',
    '208':'373',
    '209':'404',
    '211':'402',
    '210':'403',
    '214':'400',
    '212':'401',
    '213':'483',
    '217':'397',
    '216':'398',
    '215':'399',
    '218':'56',
    '220':'58',
    '222':'391',
    '221':'392',
    '219':'395',
    '224':'389',
    '225':'480',
    '226':'826',
    '223':'390',
    '235':'811',
    '234':'812',
    '233':'813',
    '232':'821',
    '231':'822',
    '230':'823',
    '229':'824',
    '227':'825',
    '245':'833',
    '244':'834',
    '243':'835',
    '242':'836',
    '241':'837',
    '240':'838',
    '239':'839',
    '238':'840',
    '237':'841',
    '236':'842',
    '3':'458',
    '2':'459',
    '1':'460',
    '247':'831',
    '246':'832',
    '632':'622',
    '248':'830',
    '252':'66',
    '253':'67',
    '254':'68',
    '256':'857',
    '255':'858',
    '268':'852',
    '267':'853',
    '266':'855',
    '269':'851',
    '270':'850',
    '7':'636',
    '6':'637',
    '5':'638',
    '271':'849',
    '277':'843',
    '276':'844',
    '275':'845',
    '274':'846',
    '273':'847',
    '272':'848',
    '280':'872',
    '279':'873',
    '278':'874',
    '281':'871',
    '282':'870',
    '285':'868',
    '286':'867',
    '287':'866',
    '288':'865',
    '289':'864',
    '293':'860',
    '292':'861',
    '291':'862',
    '290':'863',
    '294':'859',
    '295':'228',
    '302':'221',
    '301':'222',
    '300':'223',
    '299':'224',
    '298':'225',
    '297':'226',
    '296':'227',
    '303':'79',
    '304':'80',
    '303':'220',
    '305':'880',
    '306':'879',
    '307':'878',
    '310':'875',
    '309':'876',
    '308':'877',
    '311':'244',
    '312':'243',
    '313':'242',
    '314':'240',
    '317':'239',
    '321':'645',
    '324':'238',
    '327':'234',
    '326':'235',
    '325':'237',
    '334':'93',
    '335':'229',
    '336':'260',
    '339':'257',
    '338':'258',
    '337':'259',
    '342':'254',
    '341':'255',
    '340':'256',
    '343':'252',
    '347':'248',
    '348':'247',
    '350':'246',
    '351':'100',
    '353':'102',
    '354':'103',
    '355':'104',
    '356':'105',
    '356':'273',
    '360':'270',
    '359':'271',
    '358':'272',
    '361':'269',
    '32':'495',
    '362':'268',
    '363':'267',
    '364':'266',
    '365':'107',
    '366':'108',
    '367':'109',
    '368':'110',
    '369':'111',
    '370':'112',
    '371':'113',
    '372':'696',
    '375':'693',
    '374':'694',
    '373':'695',
    '9':'456',
    '8':'457',
    '11':'455',
    '376':'691',
    '377':'690',
    '378':'689',
    '380':'687',
    '379':'688',
    '383':'686',
    '384':'685',
    '389':'683',
    '388':'684',
    '390':'714',
    '391':'713',
    '392':'116',
    '393':'117',
    '397':'584',
    '404':'700',
    '403':'701',
    '402':'702',
    '401':'703',
    '400':'704',
    '399':'705',
    '398':'706',
    '396':'707',
    '395':'708',
    '406':'729',
    '407':'728',
    '13':'452',
    '12':'453',
    '409':'120',
    '410':'121',
    '405':'699',
    '409':'726',
    '408':'727',
    '413':'722',
    '412':'723',
    '411':'724',
    '414':'122',
    '415':'123',
    '28':'469',
    '27':'470',
    '19':'477',
    '18':'478',
    '17':'479',
    '16':'481',
    '15':'482',
    '20':'253',
    '29':'468',
    '417':'718',
    '416':'719',
    '420':'716',
    '419':'717',
    '423':'126',
    '422':'715',
    '425':'127',
    '426':'744',
    '427':'743',
    '429':'741',
    '428':'742',
    '329':'89',
    '330':'90',
    '431':'739',
    '430':'740',
    '434':'737',
    '432':'738',
    '435':'736',
    '436':'735',
    '437':'306',
    '438':'734',
    '440':'732',
    '439':'733',
    '443':'131',
    '444':'132',
    '445':'133',
    '443':'731',
    '452':'754',
    '451':'755',
    '450':'756',
    '449':'757',
    '446':'758',
    '463':'142',
    '464':'143',
    '465':'144',
    '466':'747',
    '468':'777',
    '467':'778',
    '469':'776',
    '470':'145',
    '471':'146',
    '472':'773',
    '473':'772',
    '474':'771',
    '475':'147',
    '476':'148',
    '479':'766',
    '478':'767',
    '477':'768',
    '480':'765',
    '482':'763',
    '481':'764',
    '488':'789',
    '487':'790',
    '486':'791',
    '485':'792',
    '484':'793',
    '483':'794',
    '491':'786',
    '490':'787',
    '489':'788',
    '493':'785',
    '494':'784',
    '495':'783',
    '496':'644',
    '497':'643',
    '498':'653',
    '501':'651',
    '500':'652',
    '502':'782',
    '503':'781',
    '505':'779',
    '504':'780',
    '507':'661',
    '506':'662',
    '259':'73',
    '257':'856',
    '514':'656',
    '513':'657',
    '512':'658',
    '511':'659',
    '509':'660',
    '520':'677',
    '519':'678',
    '518':'679',
    '517':'680',
    '516':'681',
    '515':'682',
    '521':'154',
    '522':'155',
    '344':'96',
    '345':'97',
    '524':'806',
    '523':'807',
    '526':'803',
    '525':'805',
    '527':'156',
    '531':'161',
    '532':'162',
    '545':'174',
    '530':'801',
    '455':'134',
    '533':'163',
    '536':'166',
    '538':'795',
    '537':'796',
    '539':'570',
    '30':'496',
    '31':'499',
    '541':'170',
    '543':'565',
    '542':'566',
    '540':'568',
    '597':'616',
    '599':'199',
    '598':'615',
    '544':'564',
    '546':'562',
    '549':'559',
    '548':'560',
    '547':'561',
    '551':'558',
    '550':'804',
    '554':'555',
    '553':'556',
    '552':'557',
    '555':'586',
    '556':'585',
    '557':'175',
    '559':'582',
    '560':'581',
    '562':'579',
    '561':'580',
    '565':'578',
    '572':'575',
    '571':'576',
    '459':'751',
    '456':'752',
    '573':'574',
    '574':'573',
    '575':'572',
    '577':'571',
    '579':'602',
    '580':'601',
    '582':'185',
    '583':'598',
    '581':'600',
    '584':'597',
    '585':'596',
    '21':'476',
    '586':'187',
    '587':'188',
    '588':'189',
    '589':'190',
    '591':'192',
    '592':'589',
    '590':'591',
    '593':'588',
    '594':'587',
    '601':'612',
    '600':'613',
    '603':'610',
    '602':'611',
    '604':'609',
    '605':'608',
    '23':'474',
    '22':'475',
    '26':'471',
    '25':'472',
    '24':'473',
    '608':'606',
    '607':'607',
    '609':'201',
    '610':'202',
    '610':'604',
    '611':'603',
    '618':'625',
    '612':'626',
    '624':'628',
    '623':'629',
    '622':'630',
    '621':'631',
    '620':'633',
    '614':'634',
    '625':'627',
    '634':'620',
    '633':'621',
    '635':'619',
    '637':'649',
    '636':'650',
    '639':'647',
    '638':'648',
    '640':'646',
    '641':'210',
    '642':'211',
    '646':'215',
    '647':'216',
    '648':'217',
    '644':'635',
    '643':'640',
    '645':'666',
    '649':'218',
    '40':'5',
    '650':'674',
    '659':'429',
    '655':'498',
    '658':'654',
    '657':'672',
    '656':'673',
    '654':'675',
    '653':'676',
    '660':'361'
}

clean_data = []
for field in fields_id_cropio:
    values = {
      "field_id": "{}".format(field),
      "type":"soil_moisture",
      "from_time":"2024-06-01",
      "to_time":"2024-06-21",
    }
    
    response = requests.get('https://operations.cropwise.com/api/v3/historical_values', params=values, headers=headers)
    
    # print(response.status_code)
    # print(response.headers)
    # print(response.json())
    
    data = response.json()['data']
    for record in data:
        soil_moisture = record['soil_moisture']
        soil_moisture_0_70 = np.round(soil_moisture[0]*100, 1)
        soil_moisture_70_280 = np.round(soil_moisture[1]*100, 1)
        soil_moisture_280_1000 = np.round(soil_moisture[2]*100, 1)
        date = record['date']
        clean_data+=[
            {
                'date':date,
                'soil_moisture_0_70':soil_moisture_0_70,
                'soil_moisture_70_280':soil_moisture_70_280,
                'soil_moisture_280_1000':soil_moisture_280_1000,
                'field_id':id_cropio_agriculturefields[field[5:]]
            }
        ]
    
df = pd.DataFrame(clean_data)
df.to_csv('C:/Users/joaos/Downloads/soil_moisture_data_202406ac.csv')

conn = psycopg2.connect(
    database="ayishi", user='developer', password='ObuEm8Ap', host='165.227.135.116', port= '5432'
)

conn.autocommit = True
cursor = conn.cursor()

for row in df.iterrows():
    command = "INSERT INTO icarda.agriculture_soilmoisture VALUES (default,'{}',{},{},{},{})".format(row[1]['date'], row[1]['soil_moisture_0_70'], row[1]['soil_moisture_70_280'], row[1]['soil_moisture_280_1000'], row[1]['field_id'])
    cursor.execute(command)
    conn.commit()

conn.close()