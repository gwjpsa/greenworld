
# -*- coding: utf-8 -*-
"""
Created on Mon Feb 12 08:38:45 2024

@author: joaos
"""

import pandas as pd
import psycopg2

path = r"C:\Users\joaos\Downloads\vegetation_history_daily_20240626.csv"
df = pd.read_csv(path)

id_cropio_agriculturefields = {
    '4':'639',
    '567':'179',
    '263':'528',
    '576':'569',
    '567':'577',
    '283':'869',
    '35':'492',
    '34':'493',
    '33':'494',
    '39':'4',
    '38':'491',
    '41':'490',
    '43':'486',
    '44':'485',
    '42':'487',
    '45':'484',
    '50':'513',
    '48':'515',
    '49':'514',
    '51':'7',
    '56':'12',
    '57':'13',
    '58':'14',
    '55':'501',
    '54':'509',
    '53':'510',
    '52':'511',
    '60':'504',
    '59':'505',
    '61':'15',
    '62':'500',
    '64':'530',
    '63':'531',
    '66':'527',
    '65':'529',
    '67':'454',
    '70':'524',
    '69':'525',
    '68':'526',
    '76':'517',
    '75':'518',
    '77':'519',
    '74':'520',
    '73':'521',
    '72':'522',
    '71':'523',
    '79':'692',
    '80':'516',
    '81':'292',
    '83':'290',
    '82':'291',
    '84':'289',
    '86':'287',
    '85':'288',
    '88':'285',
    '87':'286',
    '90':'502',
    '95':'282',
    '94':'283',
    '91':'284',
    '93':'711',
    '92':'712',
    '96':'281',
    '596':'196',
    '103':'23',
    '105':'25',
    '102':'279',
    '100':'280',
    '106':'308',
    '107':'307',
    '108':'305',
    '109':'303',
    '111':'302',
    '110':'304',
    '112':'301',
    '113':'300',
    '114':'299',
    '119':'294',
    '118':'295',
    '117':'296',
    '116':'297',
    '115':'298',
    '120':'293',
    '121':'324',
    '123':'322',
    '122':'323',
    '124':'27',
    '125':'28',
    '126':'318',
    '328':'88',
    '127':'319',
    '128':'317',
    '130':'315',
    '129':'316',
    '132':'313',
    '131':'314',
    '133':'312',
    '135':'309',
    '134':'311',
    '136':'31',
    '138':'338',
    '137':'339',
    '139':'337',
    '141':'336',
    '140':'497',
    '143':'334',
    '142':'335',
    '629':'623',
    '626':'624',
    '146':'331',
    '147':'34',
    '148':'35',
    '152':'325',
    '151':'326',
    '157':'352',
    '156':'353',
    '155':'354',
    '154':'355',
    '153':'356',
    '150':'328',
    '158':'351',
    '160':'349',
    '159':'350',
    '161':'348',
    '163':'347',
    '144':'32',
    '145':'33',
    '164':'37',
    '165':'38',
    '166':'39',
    '168':'343',
    '167':'344',
    '169':'40',
    '170':'41',
    '171':'42',
    '172':'371',
    '173':'44',
    '174':'369',
    '175':'45',
    '178':'366',
    '177':'367',
    '180':'364',
    '179':'365',
    '181':'363',
    '201':'377',
    '182':'362',
    '183':'359',
    '184':'358',
    '185':'357',
    '186':'388',
    '191':'383',
    '190':'384',
    '189':'385',
    '188':'386',
    '187':'387',
    '193':'382',
    '195':'380',
    '194':'381',
    '196':'761',
    '198':'760',
    '200':'378',
    '199':'379',
    '202':'376',
    '346':'249',
    '204':'374',
    '203':'375',
    '208':'373',
    '209':'404',
    '211':'402',
    '210':'403',
    '214':'400',
    '212':'401',
    '213':'483',
    '217':'397',
    '216':'398',
    '215':'399',
    '218':'56',
    '220':'58',
    '222':'391',
    '221':'392',
    '219':'395',
    '224':'389',
    '225':'480',
    '226':'826',
    '223':'390',
    '235':'811',
    '234':'812',
    '233':'813',
    '232':'821',
    '231':'822',
    '230':'823',
    '229':'824',
    '227':'825',
    '245':'833',
    '244':'834',
    '243':'835',
    '242':'836',
    '241':'837',
    '240':'838',
    '239':'839',
    '238':'840',
    '237':'841',
    '236':'842',
    '3':'458',
    '2':'459',
    '1':'460',
    '247':'831',
    '246':'832',
    '632':'622',
    '248':'830',
    '252':'66',
    '253':'67',
    '254':'68',
    '256':'857',
    '255':'858',
    '268':'852',
    '267':'853',
    '266':'855',
    '269':'851',
    '270':'850',
    '7':'636',
    '6':'637',
    '5':'638',
    '271':'849',
    '277':'843',
    '276':'844',
    '275':'845',
    '274':'846',
    '273':'847',
    '272':'848',
    '280':'872',
    '279':'873',
    '278':'874',
    '281':'871',
    '282':'870',
    '285':'868',
    '286':'867',
    '287':'866',
    '288':'865',
    '289':'864',
    '293':'860',
    '292':'861',
    '291':'862',
    '290':'863',
    '294':'859',
    '295':'228',
    '302':'221',
    '301':'222',
    '300':'223',
    '299':'224',
    '298':'225',
    '297':'226',
    '296':'227',
    '303':'79',
    '304':'80',
    '303':'220',
    '305':'880',
    '306':'879',
    '307':'878',
    '310':'875',
    '309':'876',
    '308':'877',
    '311':'244',
    '312':'243',
    '313':'242',
    '314':'240',
    '317':'239',
    '321':'645',
    '324':'238',
    '327':'234',
    '326':'235',
    '325':'237',
    '334':'93',
    '335':'229',
    '336':'260',
    '339':'257',
    '338':'258',
    '337':'259',
    '342':'254',
    '341':'255',
    '340':'256',
    '343':'252',
    '347':'248',
    '348':'247',
    '350':'246',
    '351':'100',
    '353':'102',
    '354':'103',
    '355':'104',
    '356':'105',
    '356':'273',
    '360':'270',
    '359':'271',
    '358':'272',
    '361':'269',
    '32':'495',
    '362':'268',
    '363':'267',
    '364':'266',
    '365':'107',
    '366':'108',
    '367':'109',
    '368':'110',
    '369':'111',
    '370':'112',
    '371':'113',
    '372':'696',
    '375':'693',
    '374':'694',
    '373':'695',
    '9':'456',
    '8':'457',
    '11':'455',
    '376':'691',
    '377':'690',
    '378':'689',
    '380':'687',
    '379':'688',
    '383':'686',
    '384':'685',
    '389':'683',
    '388':'684',
    '390':'714',
    '391':'713',
    '392':'116',
    '393':'117',
    '397':'584',
    '404':'700',
    '403':'701',
    '402':'702',
    '401':'703',
    '400':'704',
    '399':'705',
    '398':'706',
    '396':'707',
    '395':'708',
    '406':'729',
    '407':'728',
    '13':'452',
    '12':'453',
    '409':'120',
    '410':'121',
    '405':'699',
    '409':'726',
    '408':'727',
    '413':'722',
    '412':'723',
    '411':'724',
    '414':'122',
    '415':'123',
    '28':'469',
    '27':'470',
    '19':'477',
    '18':'478',
    '17':'479',
    '16':'481',
    '15':'482',
    '20':'253',
    '29':'468',
    '417':'718',
    '416':'719',
    '420':'716',
    '419':'717',
    '423':'126',
    '422':'715',
    '425':'127',
    '426':'744',
    '427':'743',
    '429':'741',
    '428':'742',
    '329':'89',
    '330':'90',
    '431':'739',
    '430':'740',
    '434':'737',
    '432':'738',
    '435':'736',
    '436':'735',
    '437':'306',
    '438':'734',
    '440':'732',
    '439':'733',
    '443':'131',
    '444':'132',
    '445':'133',
    '443':'731',
    '452':'754',
    '451':'755',
    '450':'756',
    '449':'757',
    '446':'758',
    '463':'142',
    '464':'143',
    '465':'144',
    '466':'747',
    '468':'777',
    '467':'778',
    '469':'776',
    '470':'145',
    '471':'146',
    '472':'773',
    '473':'772',
    '474':'771',
    '475':'147',
    '476':'148',
    '479':'766',
    '478':'767',
    '477':'768',
    '480':'765',
    '482':'763',
    '481':'764',
    '488':'789',
    '487':'790',
    '486':'791',
    '485':'792',
    '484':'793',
    '483':'794',
    '491':'786',
    '490':'787',
    '489':'788',
    '493':'785',
    '494':'784',
    '495':'783',
    '496':'644',
    '497':'643',
    '498':'653',
    '501':'651',
    '500':'652',
    '502':'782',
    '503':'781',
    '505':'779',
    '504':'780',
    '507':'661',
    '506':'662',
    '259':'73',
    '257':'856',
    '514':'656',
    '513':'657',
    '512':'658',
    '511':'659',
    '509':'660',
    '520':'677',
    '519':'678',
    '518':'679',
    '517':'680',
    '516':'681',
    '515':'682',
    '521':'154',
    '522':'155',
    '344':'96',
    '345':'97',
    '524':'806',
    '523':'807',
    '526':'803',
    '525':'805',
    '527':'156',
    '531':'161',
    '532':'162',
    '545':'174',
    '530':'801',
    '455':'134',
    '533':'163',
    '536':'166',
    '538':'795',
    '537':'796',
    '539':'570',
    '30':'496',
    '31':'499',
    '541':'170',
    '543':'565',
    '542':'566',
    '540':'568',
    '597':'616',
    '599':'199',
    '598':'615',
    '544':'564',
    '546':'562',
    '549':'559',
    '548':'560',
    '547':'561',
    '551':'558',
    '550':'804',
    '554':'555',
    '553':'556',
    '552':'557',
    '555':'586',
    '556':'585',
    '557':'175',
    '559':'582',
    '560':'581',
    '562':'579',
    '561':'580',
    '565':'578',
    '572':'575',
    '571':'576',
    '459':'751',
    '456':'752',
    '573':'574',
    '574':'573',
    '575':'572',
    '577':'571',
    '579':'602',
    '580':'601',
    '582':'185',
    '583':'598',
    '581':'600',
    '584':'597',
    '585':'596',
    '21':'476',
    '586':'187',
    '587':'188',
    '588':'189',
    '589':'190',
    '591':'192',
    '592':'589',
    '590':'591',
    '593':'588',
    '594':'587',
    '601':'612',
    '600':'613',
    '603':'610',
    '602':'611',
    '604':'609',
    '605':'608',
    '23':'474',
    '22':'475',
    '26':'471',
    '25':'472',
    '24':'473',
    '608':'606',
    '607':'607',
    '609':'201',
    '610':'202',
    '610':'604',
    '611':'603',
    '618':'625',
    '612':'626',
    '624':'628',
    '623':'629',
    '622':'630',
    '621':'631',
    '620':'633',
    '614':'634',
    '625':'627',
    '634':'620',
    '633':'621',
    '635':'619',
    '637':'649',
    '636':'650',
    '639':'647',
    '638':'648',
    '640':'646',
    '641':'210',
    '642':'211',
    '646':'215',
    '647':'216',
    '648':'217',
    '644':'635',
    '643':'640',
    '645':'666',
    '649':'218',
    '40':'5',
    '650':'674',
    '659':'429',
    '655':'498',
    '658':'654',
    '657':'672',
    '656':'673',
    '654':'675',
    '653':'676',
    '660':'361'
}

df = df.query("Date > '2024-06-03'")
df['Date'] = df['Date'].apply(lambda x: str(x[-2:] + '/' + x[-5:-3] + '/' + x[:4]))
columns = df.columns

new_df = pd.DataFrame(columns = ['date', 'vegetation', 'field_id'])
for column in columns[2:-1]:
    temp_df = pd.DataFrame(columns = ['date', 'vegetation', 'field_id'])
    temp_df[['date', 'vegetation']] = df[['Date', column]]
    temp_df['field_id'] = [column] * len(df['Date'])
    new_df = pd.concat([new_df, temp_df], ignore_index = True)

new_df['field_id'] = new_df['field_id'].astype(str)
new_df['field_id_icarda'] = new_df['field_id'].map(id_cropio_agriculturefields)

conn = psycopg2.connect(
    database="ayishi", user='developer', password='ObuEm8Ap', host='165.227.135.116', port= '5432'
)

conn.autocommit = True
cursor = conn.cursor()
command = "SET datestyle = dmy;"
cursor.execute(command)
conn.commit()
for row in new_df.iterrows():
    try:
        command = "INSERT INTO icarda.agriculture_vegetation(id, date, vegetation, field_id) VALUES (default, '{}', {}, {})".format(row[1]['date'], row[1]['vegetation'], row[1]['field_id_icarda'])
        cursor.execute(command)
        conn.commit()
    except:
        pass

conn.close()

#%% Try to correct the data that had wrong field ids

import pandas as pd
import psycopg2

conn = psycopg2.connect(
    database="ayishi", user='developer', password='ObuEm8Ap', host='165.227.135.116', port= '5432'
)

conn.autocommit = True
cursor = conn.cursor()
command_ = "SET datestyle = dmy;"
cursor.execute(command_)
conn.commit()
command = ''
for k in id_cropio_agriculturefields.keys():
    if command == '':
        command = f"""
            UPDATE icarda.agriculture_vegetation
            SET field_id = {id_cropio_agriculturefields[k]}
            WHERE field_id = {k};
        """
    else:
        command += f"""
            UPDATE icarda.agriculture_vegetation
            SET field_id = {id_cropio_agriculturefields[k]}
            WHERE field_id = {k};
        """

# cursor.execute(command)
# conn.commit()

# conn.close()